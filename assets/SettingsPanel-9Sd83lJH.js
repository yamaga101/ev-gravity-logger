import{c,i as u,p as h,u as v,k as T,r as j,j as t,q as U,V as A,M as O,s as q,l as C}from"./index-Bs7NSygL.js";import{P,T as D}from"./trash-2-Cc3ydF-l.js";const H=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],J=c("external-link",H);const W=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],B=c("globe",W);const Q=[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]],G=c("monitor",Q);const Z=[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]],K=c("moon",Z);const F=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],S=c("sun",F);const X=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Y=c("upload",X);const ee=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],te=c("wifi-off",ee);function re(r,a,s){const l={version:"3.0.0",exportedAt:new Date().toISOString(),history:r,locations:a,settings:s},m=JSON.stringify(l,null,2),x=new Blob([m],{type:"application/json"}),n=URL.createObjectURL(x),i=document.createElement("a");i.href=n,i.download=`ev-gravity-backup-${new Date().toISOString().slice(0,10)}.json`,i.click(),URL.revokeObjectURL(n)}function ae(r){if(!r||typeof r!="object")return!1;const a=r;return typeof a.id=="string"&&typeof a.startTime=="string"&&typeof a.odometer=="number"&&typeof a.startBattery=="number"&&typeof a.startRange=="number"&&typeof a.efficiency=="number"&&typeof a.startedAt=="number"&&typeof a.locationName=="string"&&(typeof a.voltage=="number"||typeof a.voltage=="string")&&(typeof a.amperage=="number"||typeof a.amperage=="string")&&(typeof a.kw=="number"||typeof a.kw=="string")&&typeof a.endTime=="string"&&typeof a.endBattery=="number"&&typeof a.endRange=="number"&&typeof a.chargedKwh=="number"&&typeof a.cost=="number"&&typeof a.duration=="number"&&typeof a.chargeSpeed=="number"}function se(r){if(!r||typeof r!="object")return!1;const a=r;return typeof a.id=="string"&&typeof a.name=="string"&&typeof a.voltage=="number"&&typeof a.amperage=="number"&&typeof a.kw=="number"}function oe(r){if(!r||typeof r!="object")return!1;const a=r;return typeof a.batteryCapacity=="number"&&typeof a.electricityRate=="number"&&typeof a.nightRate=="number"&&typeof a.useNightRate=="boolean"&&typeof a.gasUrl=="string"}async function ne(r){const a=await r.text(),s=JSON.parse(a);if(s.version&&typeof s.version!="string")throw new Error("Invalid export file: version must be a string");const l=[];if(Array.isArray(s.history))for(const n of s.history)ae(n)&&l.push(n);const m=[];if(Array.isArray(s.locations))for(const n of s.locations)se(n)&&m.push(n);let x=null;return s.settings&&oe(s.settings)&&(x=s.settings),{history:l,locations:m,settings:x}}function ce({t:r}){const a=u(e=>e.settings),s=u(e=>e.updateSettings),l=u(e=>e.lang),m=u(e=>e.setLang),x=u(e=>e.theme),n=u(e=>e.setTheme),i=h(e=>e.locations),L=h(e=>e.addLocation),R=h(e=>e.updateLocation),M=h(e=>e.removeLocation),E=v(e=>e.history),z=v(e=>e.importRecords),N=v(e=>e.offlineQueue),g=T(e=>e.showToast),w=j.useRef(null),[o,d]=j.useState({name:"",voltage:200,amperage:15,kw:3}),[p,f]=j.useState(null),_=()=>{o.name&&(p?(R(p,o),f(null)):L(o),d({name:"",voltage:200,amperage:15,kw:3}))},I=e=>{d({name:e.name,voltage:e.voltage,amperage:e.amperage,kw:e.kw}),f(e.id)},V=()=>{d({name:"",voltage:200,amperage:15,kw:3}),f(null)},$=[{value:"light",icon:S,label:r.light},{value:"dark",icon:K,label:r.dark},{value:"system",icon:G,label:r.systemDefault}];return t.jsxs("div",{className:"h-full overflow-y-auto custom-scroll pb-4 space-y-6",children:[t.jsxs("section",{children:[t.jsxs("h3",{className:"text-sm font-semibold text-text-primary dark:text-dark-text mb-3 flex items-center gap-2",children:[t.jsx(S,{size:16})," ",r.theme]}),t.jsx("div",{className:"flex gap-2",children:$.map(({value:e,icon:y,label:b})=>t.jsxs("button",{onClick:()=>n(e),className:`flex-1 flex flex-col items-center gap-1 p-3 rounded-xl border transition-colors ${x===e?"border-ev-primary bg-ev-primary/5 text-ev-primary":"border-border dark:border-dark-border text-text-muted hover:bg-gray-50 dark:hover:bg-gray-800"}`,children:[t.jsx(y,{size:18}),t.jsx("span",{className:"text-xs font-medium",children:b})]},e))})]}),t.jsxs("section",{children:[t.jsxs("h3",{className:"text-sm font-semibold text-text-primary dark:text-dark-text mb-3 flex items-center gap-2",children:[t.jsx(B,{size:16})," ",r.language]}),t.jsx("div",{className:"flex gap-2",children:["en","ja"].map(e=>t.jsx("button",{onClick:()=>m(e),className:`flex-1 py-2 rounded-xl border text-sm font-medium transition-colors ${l===e?"border-ev-primary bg-ev-primary/5 text-ev-primary":"border-border dark:border-dark-border text-text-muted hover:bg-gray-50 dark:hover:bg-gray-800"}`,children:e==="en"?"English":"日本語"},e))})]}),t.jsxs("section",{children:[t.jsxs("h3",{className:"text-sm font-semibold text-text-primary dark:text-dark-text mb-3 flex items-center gap-2",children:[t.jsx(U,{size:16})," ",r.vehicle]}),t.jsxs("div",{className:"mb-3",children:[t.jsx("label",{className:"text-text-muted text-xs block mb-1",children:r.vehiclePreset}),t.jsx("div",{className:"flex flex-wrap gap-1",children:A.map(e=>t.jsx("button",{onClick:()=>s({batteryCapacity:e.capacity}),className:`text-xs px-2 py-1 rounded-lg border transition-colors ${a.batteryCapacity===e.capacity?"border-ev-primary bg-ev-primary/5 text-ev-primary":"border-border dark:border-dark-border text-text-muted hover:bg-gray-50 dark:hover:bg-gray-800"}`,children:e.label},e.capacity))})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-text-muted text-xs block mb-1",children:r.batteryCapacity}),t.jsx("input",{type:"number",value:a.batteryCapacity,onChange:e=>s({batteryCapacity:Number(e.target.value)}),className:"w-full rounded-lg border border-border dark:border-dark-border bg-white dark:bg-dark-surface p-2 text-sm text-text-primary dark:text-dark-text focus:outline-none focus:border-ev-primary"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-text-muted text-xs block mb-1",children:r.electricityRate}),t.jsx("input",{type:"number",value:a.electricityRate,onChange:e=>s({electricityRate:Number(e.target.value)}),step:"0.01",className:"w-full rounded-lg border border-border dark:border-dark-border bg-white dark:bg-dark-surface p-2 text-sm text-text-primary dark:text-dark-text focus:outline-none focus:border-ev-primary"})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("input",{type:"checkbox",checked:a.useNightRate,onChange:e=>s({useNightRate:e.target.checked}),className:"w-4 h-4 accent-ev-primary"}),t.jsx("label",{className:"text-text-muted text-sm",children:r.nightRate}),a.useNightRate&&t.jsx("input",{type:"number",value:a.nightRate,onChange:e=>s({nightRate:Number(e.target.value)}),step:"0.01",className:"rounded-lg border border-border dark:border-dark-border bg-white dark:bg-dark-surface p-2 text-sm w-24 ml-auto text-text-primary dark:text-dark-text focus:outline-none focus:border-ev-primary"})]})]})]}),t.jsxs("section",{children:[t.jsxs("h3",{className:"text-sm font-semibold text-text-primary dark:text-dark-text mb-2 flex items-center gap-2",children:[t.jsx(O,{size:16})," ",r.chargingLocations]}),t.jsxs("div",{className:"space-y-2 mb-4",children:[i.map(e=>t.jsxs("div",{className:`flex justify-between items-center p-2 rounded-lg border transition-colors ${p===e.id?"border-ev-primary bg-ev-primary/5":"border-border dark:border-dark-border bg-white dark:bg-dark-surface"}`,children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-sm text-ev-primary",children:e.name}),t.jsxs("div",{className:"text-xs text-text-muted",children:[e.voltage,"V / ",e.amperage,"A / ",e.kw,"kW"]})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>I(e),className:"text-text-muted hover:text-ev-primary transition-colors",children:t.jsx(P,{size:16})}),t.jsx("button",{onClick:()=>M(e.id),className:"text-text-muted hover:text-ev-error transition-colors",children:t.jsx(D,{size:16})})]})]},e.id)),i.length===0&&t.jsx("div",{className:"text-xs text-text-muted italic",children:r.noLocations})]}),t.jsxs("div",{className:"bg-surface-alt dark:bg-gray-800/50 p-3 rounded-xl border border-border dark:border-dark-border",children:[t.jsx("div",{className:"text-xs text-text-muted mb-2 uppercase font-medium",children:p?r.editLocation:r.addNewLocation}),t.jsx("input",{type:"text",placeholder:"Name",value:o.name,onChange:e=>d({...o,name:e.target.value}),className:"w-full rounded-lg border border-border dark:border-dark-border bg-white dark:bg-dark-surface p-2 mb-2 text-sm text-text-primary dark:text-dark-text focus:outline-none focus:border-ev-primary"}),t.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-2",children:[t.jsx("input",{type:"number",placeholder:"V",value:o.voltage,onChange:e=>d({...o,voltage:Number(e.target.value)}),className:"rounded-lg border border-border dark:border-dark-border bg-white dark:bg-dark-surface p-2 text-sm text-text-primary dark:text-dark-text focus:outline-none focus:border-ev-primary"}),t.jsx("input",{type:"number",placeholder:"A",value:o.amperage,onChange:e=>d({...o,amperage:Number(e.target.value)}),className:"rounded-lg border border-border dark:border-dark-border bg-white dark:bg-dark-surface p-2 text-sm text-text-primary dark:text-dark-text focus:outline-none focus:border-ev-primary"}),t.jsx("input",{type:"number",placeholder:"kW",value:o.kw,onChange:e=>d({...o,kw:Number(e.target.value)}),className:"rounded-lg border border-border dark:border-dark-border bg-white dark:bg-dark-surface p-2 text-sm text-text-primary dark:text-dark-text focus:outline-none focus:border-ev-primary"})]}),t.jsx("button",{onClick:_,className:"w-full py-2 bg-ev-primary text-white rounded-lg text-sm font-medium hover:bg-ev-primary-dark transition-colors mb-1",children:p?r.updateLocation:r.addLocation}),p&&t.jsx("button",{onClick:V,className:"w-full py-1 text-xs text-text-muted hover:text-text-primary underline",children:r.cancelEdit})]})]}),t.jsxs("section",{children:[t.jsxs("label",{className:"text-sm font-semibold text-text-primary dark:text-dark-text mb-2 flex items-center gap-2",children:[t.jsx(q,{size:16})," ",r.gasUrl]}),t.jsx("input",{type:"text",value:a.gasUrl,onChange:e=>s({gasUrl:e.target.value}),placeholder:"https://script.google.com/...",className:"w-full rounded-lg border border-border dark:border-dark-border bg-white dark:bg-dark-surface p-3 text-sm text-text-primary dark:text-dark-text focus:outline-none focus:border-ev-primary"}),t.jsxs("a",{href:"https://docs.google.com/spreadsheets/d/1Cvn4oUoN7lsd5VW0MufgwSwrdNC-LE9VbPwZ2eG0cvA",target:"_blank",rel:"noopener noreferrer",className:"mt-2 flex items-center justify-center gap-2 py-2 rounded-xl border border-ev-primary/50 text-ev-primary text-sm font-medium hover:bg-ev-primary/5 transition-colors",children:[t.jsx(J,{size:14})," ",r.openSpreadsheet]})]}),t.jsxs("section",{children:[t.jsxs("h3",{className:"text-sm font-semibold text-text-primary dark:text-dark-text mb-3 flex items-center gap-2",children:[t.jsx(C,{size:16})," ",r.jsonExport," / ",r.jsonImport]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("button",{onClick:()=>{re(E,i,a),g(r.jsonExportSuccess,"success")},className:"flex-1 flex items-center justify-center gap-2 py-2 rounded-xl border border-ev-primary text-ev-primary text-sm font-medium hover:bg-ev-primary/5 transition-colors",children:[t.jsx(C,{size:14})," ",r.jsonExport]}),t.jsxs("button",{onClick:()=>w.current?.click(),className:"flex-1 flex items-center justify-center gap-2 py-2 rounded-xl border border-ev-secondary text-ev-secondary text-sm font-medium hover:bg-ev-secondary/5 transition-colors",children:[t.jsx(Y,{size:14})," ",r.jsonImport]})]}),t.jsx("input",{ref:w,type:"file",accept:".json",className:"hidden",onChange:async e=>{const y=e.target.files?.[0];if(y){try{const b=await ne(y),k=z(b.history);g(r.jsonImportSuccess.replace("{n}",String(k)),"success"),b.history.length-k>0&&g(r.jsonImportSkipped.replace("{n}",String(b.history.length-k)),"info")}catch{g(r.jsonImportError,"error")}e.target.value=""}}})]}),N.length>0&&t.jsxs("section",{className:"bg-ev-warning/10 border border-ev-warning/30 rounded-xl p-3",children:[t.jsxs("div",{className:"text-ev-warning text-sm font-medium flex items-center gap-2",children:[t.jsx(te,{size:14})," ",r.offlineQueue,": ",N.length," ",r.pendingItems]}),t.jsx("p",{className:"text-xs text-text-muted mt-1",children:r.autoSendOnline})]})]})}export{ce as SettingsPanel};
