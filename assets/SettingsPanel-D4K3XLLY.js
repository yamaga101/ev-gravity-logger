import{c as u,i as p,p as h,u as v,k as O,r as j,j as t,q as U,V as A,M as V,s as P,l as C}from"./index-CRx91wwA.js";import{P as q,T as D}from"./trash-2-D8Nmx2Ie.js";const J=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],B=u("globe",J);const H=[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]],Q=u("monitor",H);const W=[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]],G=u("moon",W);const K=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],S=u("sun",K);const Z=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],F=u("upload",Z);const X=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],Y=u("wifi-off",X);function ee(a,r,s){const c={version:"3.0.0",exportedAt:new Date().toISOString(),history:a,locations:r,settings:s},l=JSON.stringify(c,null,2),m=new Blob([l],{type:"application/json"}),n=URL.createObjectURL(m),i=document.createElement("a");i.href=n,i.download=`ev-gravity-backup-${new Date().toISOString().slice(0,10)}.json`,i.click(),URL.revokeObjectURL(n)}function te(a){if(!a||typeof a!="object")return!1;const r=a;return typeof r.id=="string"&&typeof r.startTime=="string"&&typeof r.odometer=="number"&&typeof r.startBattery=="number"&&typeof r.startRange=="number"&&typeof r.efficiency=="number"&&typeof r.startedAt=="number"&&typeof r.locationName=="string"&&(typeof r.voltage=="number"||typeof r.voltage=="string")&&(typeof r.amperage=="number"||typeof r.amperage=="string")&&(typeof r.kw=="number"||typeof r.kw=="string")&&typeof r.endTime=="string"&&typeof r.endBattery=="number"&&typeof r.endRange=="number"&&typeof r.chargedKwh=="number"&&typeof r.cost=="number"&&typeof r.duration=="number"&&typeof r.chargeSpeed=="number"}function re(a){if(!a||typeof a!="object")return!1;const r=a;return typeof r.id=="string"&&typeof r.name=="string"&&typeof r.voltage=="number"&&typeof r.amperage=="number"&&typeof r.kw=="number"}function ae(a){if(!a||typeof a!="object")return!1;const r=a;return typeof r.batteryCapacity=="number"&&typeof r.electricityRate=="number"&&typeof r.nightRate=="number"&&typeof r.useNightRate=="boolean"&&typeof r.gasUrl=="string"}async function se(a){const r=await a.text(),s=JSON.parse(r);if(s.version&&typeof s.version!="string")throw new Error("Invalid export file: version must be a string");const c=[];if(Array.isArray(s.history))for(const n of s.history)te(n)&&c.push(n);const l=[];if(Array.isArray(s.locations))for(const n of s.locations)re(n)&&l.push(n);let m=null;return s.settings&&ae(s.settings)&&(m=s.settings),{history:c,locations:l,settings:m}}function ie({t:a}){const r=p(e=>e.settings),s=p(e=>e.updateSettings),c=p(e=>e.lang),l=p(e=>e.setLang),m=p(e=>e.theme),n=p(e=>e.setTheme),i=h(e=>e.locations),L=h(e=>e.addLocation),R=h(e=>e.updateLocation),M=h(e=>e.removeLocation),z=v(e=>e.history),E=v(e=>e.importRecords),N=v(e=>e.offlineQueue),g=O(e=>e.showToast),w=j.useRef(null),[o,d]=j.useState({name:"",voltage:200,amperage:15,kw:3}),[x,f]=j.useState(null),I=()=>{o.name&&(x?(R(x,o),f(null)):L(o),d({name:"",voltage:200,amperage:15,kw:3}))},_=e=>{d({name:e.name,voltage:e.voltage,amperage:e.amperage,kw:e.kw}),f(e.id)},T=()=>{d({name:"",voltage:200,amperage:15,kw:3}),f(null)},$=[{value:"light",icon:S,label:a.light},{value:"dark",icon:G,label:a.dark},{value:"system",icon:Q,label:a.systemDefault}];return t.jsxs("div",{className:"h-full overflow-y-auto custom-scroll pb-4 space-y-6",children:[t.jsxs("section",{children:[t.jsxs("h3",{className:"text-sm font-semibold text-text-primary dark:text-dark-text mb-3 flex items-center gap-2",children:[t.jsx(S,{size:16})," ",a.theme]}),t.jsx("div",{className:"flex gap-2",children:$.map(({value:e,icon:y,label:b})=>t.jsxs("button",{onClick:()=>n(e),className:`flex-1 flex flex-col items-center gap-1 p-3 rounded-xl border transition-colors ${m===e?"border-ev-primary bg-ev-primary/5 text-ev-primary":"border-border dark:border-dark-border text-text-muted hover:bg-gray-50 dark:hover:bg-gray-800"}`,children:[t.jsx(y,{size:18}),t.jsx("span",{className:"text-xs font-medium",children:b})]},e))})]}),t.jsxs("section",{children:[t.jsxs("h3",{className:"text-sm font-semibold text-text-primary dark:text-dark-text mb-3 flex items-center gap-2",children:[t.jsx(B,{size:16})," ",a.language]}),t.jsx("div",{className:"flex gap-2",children:["en","ja"].map(e=>t.jsx("button",{onClick:()=>l(e),className:`flex-1 py-2 rounded-xl border text-sm font-medium transition-colors ${c===e?"border-ev-primary bg-ev-primary/5 text-ev-primary":"border-border dark:border-dark-border text-text-muted hover:bg-gray-50 dark:hover:bg-gray-800"}`,children:e==="en"?"English":"日本語"},e))})]}),t.jsxs("section",{children:[t.jsxs("h3",{className:"text-sm font-semibold text-text-primary dark:text-dark-text mb-3 flex items-center gap-2",children:[t.jsx(U,{size:16})," ",a.vehicle]}),t.jsxs("div",{className:"mb-3",children:[t.jsx("label",{className:"text-text-muted text-xs block mb-1",children:a.vehiclePreset}),t.jsx("div",{className:"flex flex-wrap gap-1",children:A.map(e=>t.jsx("button",{onClick:()=>s({batteryCapacity:e.capacity}),className:`text-xs px-2 py-1 rounded-lg border transition-colors ${r.batteryCapacity===e.capacity?"border-ev-primary bg-ev-primary/5 text-ev-primary":"border-border dark:border-dark-border text-text-muted hover:bg-gray-50 dark:hover:bg-gray-800"}`,children:e.label},e.capacity))})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-text-muted text-xs block mb-1",children:a.batteryCapacity}),t.jsx("input",{type:"number",value:r.batteryCapacity,onChange:e=>s({batteryCapacity:Number(e.target.value)}),className:"w-full rounded-lg border border-border dark:border-dark-border bg-white dark:bg-dark-surface p-2 text-sm text-text-primary dark:text-dark-text focus:outline-none focus:border-ev-primary"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-text-muted text-xs block mb-1",children:a.electricityRate}),t.jsx("input",{type:"number",value:r.electricityRate,onChange:e=>s({electricityRate:Number(e.target.value)}),step:"0.01",className:"w-full rounded-lg border border-border dark:border-dark-border bg-white dark:bg-dark-surface p-2 text-sm text-text-primary dark:text-dark-text focus:outline-none focus:border-ev-primary"})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("input",{type:"checkbox",checked:r.useNightRate,onChange:e=>s({useNightRate:e.target.checked}),className:"w-4 h-4 accent-ev-primary"}),t.jsx("label",{className:"text-text-muted text-sm",children:a.nightRate}),r.useNightRate&&t.jsx("input",{type:"number",value:r.nightRate,onChange:e=>s({nightRate:Number(e.target.value)}),step:"0.01",className:"rounded-lg border border-border dark:border-dark-border bg-white dark:bg-dark-surface p-2 text-sm w-24 ml-auto text-text-primary dark:text-dark-text focus:outline-none focus:border-ev-primary"})]})]})]}),t.jsxs("section",{children:[t.jsxs("h3",{className:"text-sm font-semibold text-text-primary dark:text-dark-text mb-2 flex items-center gap-2",children:[t.jsx(V,{size:16})," ",a.chargingLocations]}),t.jsxs("div",{className:"space-y-2 mb-4",children:[i.map(e=>t.jsxs("div",{className:`flex justify-between items-center p-2 rounded-lg border transition-colors ${x===e.id?"border-ev-primary bg-ev-primary/5":"border-border dark:border-dark-border bg-white dark:bg-dark-surface"}`,children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-sm text-ev-primary",children:e.name}),t.jsxs("div",{className:"text-xs text-text-muted",children:[e.voltage,"V / ",e.amperage,"A / ",e.kw,"kW"]})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>_(e),className:"text-text-muted hover:text-ev-primary transition-colors",children:t.jsx(q,{size:16})}),t.jsx("button",{onClick:()=>M(e.id),className:"text-text-muted hover:text-ev-error transition-colors",children:t.jsx(D,{size:16})})]})]},e.id)),i.length===0&&t.jsx("div",{className:"text-xs text-text-muted italic",children:a.noLocations})]}),t.jsxs("div",{className:"bg-surface-alt dark:bg-gray-800/50 p-3 rounded-xl border border-border dark:border-dark-border",children:[t.jsx("div",{className:"text-xs text-text-muted mb-2 uppercase font-medium",children:x?a.editLocation:a.addNewLocation}),t.jsx("input",{type:"text",placeholder:"Name",value:o.name,onChange:e=>d({...o,name:e.target.value}),className:"w-full rounded-lg border border-border dark:border-dark-border bg-white dark:bg-dark-surface p-2 mb-2 text-sm text-text-primary dark:text-dark-text focus:outline-none focus:border-ev-primary"}),t.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-2",children:[t.jsx("input",{type:"number",placeholder:"V",value:o.voltage,onChange:e=>d({...o,voltage:Number(e.target.value)}),className:"rounded-lg border border-border dark:border-dark-border bg-white dark:bg-dark-surface p-2 text-sm text-text-primary dark:text-dark-text focus:outline-none focus:border-ev-primary"}),t.jsx("input",{type:"number",placeholder:"A",value:o.amperage,onChange:e=>d({...o,amperage:Number(e.target.value)}),className:"rounded-lg border border-border dark:border-dark-border bg-white dark:bg-dark-surface p-2 text-sm text-text-primary dark:text-dark-text focus:outline-none focus:border-ev-primary"}),t.jsx("input",{type:"number",placeholder:"kW",value:o.kw,onChange:e=>d({...o,kw:Number(e.target.value)}),className:"rounded-lg border border-border dark:border-dark-border bg-white dark:bg-dark-surface p-2 text-sm text-text-primary dark:text-dark-text focus:outline-none focus:border-ev-primary"})]}),t.jsx("button",{onClick:I,className:"w-full py-2 bg-ev-primary text-white rounded-lg text-sm font-medium hover:bg-ev-primary-dark transition-colors mb-1",children:x?a.updateLocation:a.addLocation}),x&&t.jsx("button",{onClick:T,className:"w-full py-1 text-xs text-text-muted hover:text-text-primary underline",children:a.cancelEdit})]})]}),t.jsxs("section",{children:[t.jsxs("label",{className:"text-sm font-semibold text-text-primary dark:text-dark-text mb-2 flex items-center gap-2",children:[t.jsx(P,{size:16})," ",a.gasUrl]}),t.jsx("input",{type:"text",value:r.gasUrl,onChange:e=>s({gasUrl:e.target.value}),placeholder:"https://script.google.com/...",className:"w-full rounded-lg border border-border dark:border-dark-border bg-white dark:bg-dark-surface p-3 text-sm text-text-primary dark:text-dark-text focus:outline-none focus:border-ev-primary"})]}),t.jsxs("section",{children:[t.jsxs("h3",{className:"text-sm font-semibold text-text-primary dark:text-dark-text mb-3 flex items-center gap-2",children:[t.jsx(C,{size:16})," ",a.jsonExport," / ",a.jsonImport]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("button",{onClick:()=>{ee(z,i,r),g(a.jsonExportSuccess,"success")},className:"flex-1 flex items-center justify-center gap-2 py-2 rounded-xl border border-ev-primary text-ev-primary text-sm font-medium hover:bg-ev-primary/5 transition-colors",children:[t.jsx(C,{size:14})," ",a.jsonExport]}),t.jsxs("button",{onClick:()=>w.current?.click(),className:"flex-1 flex items-center justify-center gap-2 py-2 rounded-xl border border-ev-secondary text-ev-secondary text-sm font-medium hover:bg-ev-secondary/5 transition-colors",children:[t.jsx(F,{size:14})," ",a.jsonImport]})]}),t.jsx("input",{ref:w,type:"file",accept:".json",className:"hidden",onChange:async e=>{const y=e.target.files?.[0];if(y){try{const b=await se(y),k=E(b.history);g(a.jsonImportSuccess.replace("{n}",String(k)),"success"),b.history.length-k>0&&g(a.jsonImportSkipped.replace("{n}",String(b.history.length-k)),"info")}catch{g(a.jsonImportError,"error")}e.target.value=""}}})]}),N.length>0&&t.jsxs("section",{className:"bg-ev-warning/10 border border-ev-warning/30 rounded-xl p-3",children:[t.jsxs("div",{className:"text-ev-warning text-sm font-medium flex items-center gap-2",children:[t.jsx(Y,{size:14})," ",a.offlineQueue,": ",N.length," ",a.pendingItems]}),t.jsx("p",{className:"text-xs text-text-muted mt-1",children:a.autoSendOnline})]})]})}export{ie as SettingsPanel};
