import{c as B,D as L,a as F,b as z,d as I,f as w,e as M,C as q,g as _,h as P,j as e,u as k,r as g,S as y,i as A,k as K,l as X,M as G,m as J}from"./index-Duchf94s.js";import{P as U,T as E}from"./trash-2-D8J-BUNf.js";const Q=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],D=B("arrow-right",Q);const Z=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],ee=B("x",Z);function te(s,d,o){const b=d.batteryCapacity||L,n=d.electricityRate||F,c="\uFEFF",l=q[o],p=s.map(a=>{const h=z(b,a.startBattery||0,a.endBattery||a.batteryAfter||0),C=_(h,n),v=a.startTime&&a.endTime?I(a.startTime,a.endTime):0,j=P(h,v);return[a.startTime?w(a.startTime):w(a.timestamp||""),a.startTime||"",a.endTime||"",a.odometer||"",a.startBattery||a.battery||"",a.endBattery||a.batteryAfter||"",a.startRange||"",a.endRange||"",h.toFixed(1),C,M(v),j.toFixed(1),a.efficiency||"",a.locationName||""].map(x=>`"${x}"`).join(",")}),r=c+l.join(",")+`
`+p.join(`
`),u=new Blob([r],{type:"text/csv;charset=utf-8;"}),i=URL.createObjectURL(u),f=document.createElement("a");f.href=i,f.download=`ev-gravity-log-${new Date().toISOString().slice(0,10)}.csv`,f.click(),URL.revokeObjectURL(i)}function re({isOpen:s,onClose:d,title:o,titleIcon:b,children:n,footer:c}){return s?e.jsx("div",{className:"fixed inset-0 z-50 flex items-end sm:items-center justify-center sm:p-4 bg-black/50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white dark:bg-dark-surface w-full sm:max-w-lg h-[90vh] sm:h-auto sm:max-h-[90vh] rounded-t-2xl sm:rounded-2xl shadow-xl flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-border dark:border-dark-border",children:[e.jsxs("h2",{className:"text-lg font-semibold text-text-primary dark:text-dark-text flex items-center gap-2",children:[b,o]}),e.jsx("button",{onClick:d,className:"p-1 rounded-lg text-text-muted hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",children:e.jsx(ee,{size:20})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 custom-scroll",children:n}),c&&e.jsx("div",{className:"p-4 border-t border-border dark:border-dark-border",children:c})]})}):null}function se({item:s,onClose:d,t:o}){const b=k(r=>r.updateRecord),[n,c]=g.useState(null);if(g.useEffect(()=>{s&&c({...s})},[s]),!s||!n)return null;const l=(r,u)=>c(i=>i&&{...i,[r]:u}),p=()=>{n&&(b(n),d())};return e.jsx(re,{isOpen:!!s,onClose:d,title:o.editSession,titleIcon:e.jsx(U,{size:18}),footer:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:d,className:"flex-1 py-3 border border-border dark:border-dark-border text-text-muted font-medium rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:o.cancel}),e.jsx("button",{onClick:p,className:"flex-[2] py-3 bg-ev-primary text-white font-medium rounded-xl hover:bg-ev-primary-dark transition-colors",children:o.saveChanges})]}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-text-muted text-xs font-medium uppercase mb-1 block",children:o.start}),e.jsx("input",{type:"datetime-local",value:n.startTime||n.timestamp||"",onChange:r=>l("startTime",r.target.value),className:"w-full rounded-lg border border-border dark:border-dark-border bg-white dark:bg-dark-surface p-2 text-sm text-text-primary dark:text-dark-text focus:outline-none focus:border-ev-primary"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-text-muted text-xs font-medium uppercase mb-1 block",children:o.end}),e.jsx("input",{type:"datetime-local",value:n.endTime||"",onChange:r=>l("endTime",r.target.value),className:"w-full rounded-lg border border-border dark:border-dark-border bg-white dark:bg-dark-surface p-2 text-sm text-text-primary dark:text-dark-text focus:outline-none focus:border-ev-primary"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-text-muted text-xs font-medium uppercase mb-1 block",children:o.odometer}),e.jsxs("div",{className:"flex items-center gap-1 border border-border dark:border-dark-border rounded-lg p-2",children:[[-100,-10].map(r=>e.jsx("button",{onClick:()=>l("odometer",Number(n.odometer||0)+r),className:"h-8 w-12 flex items-center justify-center rounded bg-gray-50 dark:bg-gray-800 text-ev-error text-xs font-bold",children:r},r)),e.jsx("input",{type:"number",value:Number(n.odometer||0),onChange:r=>l("odometer",Number(r.target.value)),className:"flex-1 bg-transparent text-center text-lg font-semibold text-ev-primary focus:outline-none"}),[10,100].map(r=>e.jsxs("button",{onClick:()=>l("odometer",Number(n.odometer||0)+r),className:"h-8 w-12 flex items-center justify-center rounded bg-gray-50 dark:bg-gray-800 text-ev-primary text-xs font-bold",children:["+",r]},r))]})]}),e.jsx(y,{label:o.efficiency,value:Number(n.efficiency),unit:"km/kWh",steps:[-1,-.1,.1,1],min:0,max:20,onChange:r=>l("efficiency",r)}),e.jsxs("div",{className:"p-3 border border-border dark:border-dark-border rounded-lg bg-surface-alt dark:bg-gray-800/50",children:[e.jsx("div",{className:"text-xs text-text-muted mb-2 uppercase tracking-wider font-medium",children:o.startConditions}),e.jsx(y,{label:o.battPct,value:Number(n.startBattery||n.battery||0),unit:"%",onChange:r=>l("startBattery",r)}),e.jsx(y,{label:o.range,value:Number(n.startRange||0),unit:"km",onChange:r=>l("startRange",r)})]}),e.jsxs("div",{className:"p-3 border border-border dark:border-dark-border rounded-lg bg-surface-alt dark:bg-gray-800/50",children:[e.jsx("div",{className:"text-xs text-text-muted mb-2 uppercase tracking-wider font-medium",children:o.endConditions}),e.jsx(y,{label:o.battPct,value:Number(n.endBattery||n.batteryAfter||0),unit:"%",onChange:r=>l("endBattery",r)}),e.jsx(y,{label:o.range,value:Number(n.endRange||0),unit:"km",onChange:r=>l("endRange",r)})]})]})})}function oe({t:s}){const d=k(t=>t.history),o=k(t=>t.deleteRecord),b=k(t=>t.deleteRecords),n=k(t=>t.deleteAllRecords),c=A(t=>t.settings),l=A(t=>t.lang),p=K(t=>t.showToast),[r,u]=g.useState([]),[i,f]=g.useState(""),[a,h]=g.useState(null),C=c.batteryCapacity||L,v=c.electricityRate||F,j=g.useMemo(()=>{const t=new Set;return d.forEach(m=>{m.locationName&&t.add(m.locationName)}),[...t]},[d]),x=g.useMemo(()=>i?d.filter(t=>t.locationName===i):d,[d,i]),O=t=>u(m=>m.includes(t)?m.filter(T=>T!==t):[...m,t]),$=()=>{r.length===x.length?u([]):u(x.map(t=>t.id))},H=()=>{r.length>0&&confirm(s.confirmDeleteN.replace("{n}",String(r.length)))&&(b(r),u([]))},V=()=>{confirm(s.confirmDeleteAll)&&n()},W=t=>{confirm(s.confirmDelete)&&o(t)},Y=()=>{te(d,c,l),p(s.toastCsvExported,"success")};return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"flex justify-between items-center mb-3",children:e.jsxs("div",{className:"flex gap-2 items-center",children:[d.length>0&&e.jsxs("button",{onClick:Y,className:"text-xs text-ev-primary border border-ev-primary px-2 py-1 rounded-lg hover:bg-ev-primary/10 flex items-center gap-1 transition-colors",children:[e.jsx(X,{size:12})," ",s.csv]}),r.length>0?e.jsxs("button",{onClick:H,className:"text-xs text-ev-error border border-ev-error px-2 py-1 rounded-lg hover:bg-ev-error/10 flex items-center gap-1 transition-colors",children:[e.jsx(E,{size:12})," ",s.delete," (",r.length,")"]}):d.length>0&&e.jsx("button",{onClick:V,className:"text-xs text-text-muted border border-border dark:border-dark-border px-2 py-1 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",children:s.deleteAll})]})}),j.length>0&&e.jsxs("select",{value:i,onChange:t=>f(t.target.value),className:"mb-2 rounded-lg border border-border dark:border-dark-border bg-white dark:bg-dark-surface p-1.5 text-xs text-text-primary dark:text-dark-text w-full appearance-none",children:[e.jsx("option",{value:"",children:s.allLocations}),j.map(t=>e.jsx("option",{value:t,children:t},t))]}),x.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-2 px-1",children:[e.jsx("input",{type:"checkbox",checked:x.length>0&&r.length===x.length,onChange:$,className:"w-4 h-4 rounded accent-ev-primary cursor-pointer"}),e.jsxs("span",{className:"text-xs text-text-muted",children:[s.selectAll," (",x.length,")"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scroll space-y-3 pb-4",children:x.length===0?e.jsx("div",{className:"text-center text-text-muted py-10",children:s.noRecords}):x.map(t=>{const m=z(C,t.startBattery||0,t.endBattery||t.batteryAfter||0),T=_(m,v),R=t.startTime&&t.endTime?I(t.startTime,t.endTime):0,N=P(m,R),S=J(N);return e.jsx("div",{className:`bg-white dark:bg-dark-surface rounded-lg p-3 border-l-4 shadow-sm transition-colors ${r.includes(t.id)?"border-ev-primary bg-ev-primary/5":"border-gray-200 dark:border-gray-700"}`,style:!r.includes(t.id)&&N>0?{borderLeftColor:S.color}:void 0,children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1 min-w-0",children:[e.jsx("input",{type:"checkbox",checked:r.includes(t.id),onChange:()=>O(t.id),className:"mt-1 w-4 h-4 rounded accent-ev-primary cursor-pointer flex-shrink-0"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-xs text-text-muted",children:t.startTime?w(t.startTime):w(t.timestamp||"")}),e.jsxs("div",{className:"flex items-baseline gap-1 mt-1",children:[e.jsx("span",{className:"text-lg font-semibold text-text-primary dark:text-dark-text",children:t.startRange||"-"}),e.jsx(D,{size:12,className:"text-text-muted inline"}),e.jsx("span",{className:"text-lg font-semibold text-text-primary dark:text-dark-text",children:t.endRange||"-"}),e.jsx("span",{className:"text-xs text-text-muted",children:"km"})]}),e.jsxs("div",{className:"text-sm text-text-primary dark:text-dark-text mt-0.5",children:[s.battPct,": ",t.startBattery||t.battery,"%"," ",e.jsx(D,{size:10,className:"inline text-text-muted"})," ",t.endBattery||t.batteryAfter,"%"]}),e.jsxs("div",{className:"flex gap-3 mt-1 text-xs",children:[e.jsxs("span",{className:"text-ev-primary font-medium",children:[m.toFixed(1),"kWh"]}),e.jsxs("span",{className:"text-ev-success font-medium",children:["Â¥",T]}),R>0&&e.jsx("span",{className:"text-text-primary dark:text-dark-text",children:M(R)}),N>0&&e.jsxs("span",{style:{color:S.color},children:[S.emoji," ",N.toFixed(1),"kW"]})]}),t.locationName&&e.jsxs("div",{className:"text-xs text-ev-primary mt-1 flex items-center gap-1",children:[e.jsx(G,{size:10})," ",t.locationName]})]})]}),e.jsxs("div",{className:"flex gap-2 flex-shrink-0",children:[e.jsx("button",{onClick:()=>h(t),title:s.editSession,className:"h-9 w-9 flex items-center justify-center bg-ev-primary text-white rounded-lg hover:bg-ev-primary-dark transition-colors",children:e.jsx(U,{size:16})}),e.jsx("button",{onClick:()=>W(t.id),title:s.delete,className:"h-9 w-9 flex items-center justify-center border border-ev-error text-ev-error rounded-lg hover:bg-ev-error hover:text-white transition-colors",children:e.jsx(E,{size:16})})]})]})},t.id)})}),e.jsx(se,{item:a,onClose:()=>h(null),t:s})]})}export{oe as HistoryList};
